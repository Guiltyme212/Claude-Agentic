# Workflow: Send Cold Email via SMTP

## Objective
Send a personalized cold email from dan@aiboostly.com to a business lead, linking to the preview website built by the pipeline. Uses direct SMTP (GoDaddy/Outlook) — no third-party sending platform needed.

## Tool
`Tools/send_email.py`

## Prerequisites
- SMTP credentials set in `.env` (SMTP_HOST, SMTP_USER, SMTP_PASSWORD)
- Email draft generated by previous pipeline step

## Inputs
- `to_email` (str): recipient business email from sheet
- `email_body` (str): generated email body from draft_email step
- `business_name` (str, optional): for subject line template
- `test_mode` (bool): redirect to SMTP_TEST_EMAIL

## Steps
1. Build MIME multipart/alternative message (plain text + HTML)
2. Set proper headers: From, To, Subject, Date, Message-ID, Reply-To
3. If test mode: redirect recipient to SMTP_TEST_EMAIL
4. Generate subject from template: "Preview website voor {Business Name}"
5. Connect to SMTP server with STARTTLS
6. Authenticate and send
7. Retry 3x with 5/10/20s backoff on transient errors
8. Return result dict

## Output
Dict: `{"status": "sent", "to_email": "...", "subject": "..."}`

## Skip Conditions
- Email Status is BLACKLISTED or INVALID → skip (handled in run_pipeline.py)
- Email column is empty → skip (handled in run_pipeline.py)

## Test Mode
Set `SMTP_TEST_EMAIL=dan.ivdnis@gmail.com` in .env. All emails redirect to this address. Remove/comment out for production.

## Failure Handling
- Auth error → fail immediately (wrong credentials)
- SMTP/network error → retry 3x with 5/10/20s backoff
- All retries exhausted → raise exception → pipeline sets STATUS=ERROR

## CLI Usage
```bash
python Tools/send_email.py \
  --to "info@loodgieter-jansen.nl" \
  --body "Hoi Jan, ik heb een preview website gemaakt..." \
  --business-name "Loodgieter Jansen" \
  --test-email "dan.ivdnis@gmail.com"
```
